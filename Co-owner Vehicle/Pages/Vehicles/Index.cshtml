@page
@model Co_owner_Vehicle.Pages.Vehicles.IndexModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω xe";
}

<!-- Success/Error Messages -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>@TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>@TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-1">
            <i class="bi bi-car-front text-primary me-2"></i>Qu·∫£n l√Ω xe
        </h2>
        <p class="text-muted mb-0">Danh s√°ch xe ƒë·ªìng s·ªü h·ªØu c·ªßa b·∫°n</p>
    </div>
    <div>
        <button class="btn btn-outline-secondary me-2">
            <i class="bi bi-funnel me-2"></i>L·ªçc
        </button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
            <i class="bi bi-plus-lg me-2"></i>Th√™m xe m·ªõi
        </button>
    </div>
</div>

<!-- Filter & Search -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" name="searchTerm" 
                           value="@Model.SearchTerm" placeholder="üîç T√¨m ki·∫øm theo t√™n, bi·ªÉn s·ªë...">
                </div>
                <div class="col-md-3">
                    <select class="form-select" name="vehicleTypeFilter" asp-for="VehicleTypeFilter">
                        <option value="">T·∫•t c·∫£ lo·∫°i xe</option>
                        <option value="ElectricCar">Xe ƒëi·ªán</option>
                        <option value="HybridCar">Hybrid</option>
                        <option value="GasolineCar">XƒÉng</option>
                        <option value="Motorcycle">Xe m√°y</option>
                        <option value="Bicycle">Xe ƒë·∫°p</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" name="statusFilter" asp-for="StatusFilter">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="Active">Ho·∫°t ƒë·ªông</option>
                        <option value="Repair">ƒêang s·ª≠a</option>
                        <option value="Maintenance">B·∫£o tr√¨</option>
                        <option value="Inactive">Ng·ª´ng ho·∫°t ƒë·ªông</option>
                        <option value="Sold">ƒê√£ b√°n</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <a asp-page="/Vehicles/Index" class="btn btn-outline-danger w-100">
                        <i class="bi bi-x-lg me-2"></i>X√≥a b·ªô l·ªçc
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Vehicles Grid -->
@if (Model.Vehicles.Any())
{
    <div class="row g-4">
        @foreach (var item in Model.Vehicles)
        {
            var vehicle = item.Vehicle;
            var statusBadge = vehicle.Status switch
            {
                VehicleStatus.Active => ("bg-success", "Ho·∫°t ƒë·ªông"),
                VehicleStatus.Repair => ("bg-primary", "ƒêang s·ª≠a"),
                VehicleStatus.Maintenance => ("bg-warning", "B·∫£o tr√¨"),
                VehicleStatus.Inactive => ("bg-danger", "Ng·ª´ng ho·∫°t ƒë·ªông"),
                VehicleStatus.Sold => ("bg-secondary", "ƒê√£ b√°n"),
                _ => ("bg-secondary", vehicle.Status.ToString())
            };
            
            var typeBadge = vehicle.VehicleType switch
            {
                VehicleType.ElectricCar => ("bg-info", "Xe ƒëi·ªán"),
                VehicleType.HybridCar => ("bg-warning", "Hybrid"),
                VehicleType.GasolineCar => ("bg-danger", "XƒÉng"),
                VehicleType.Motorcycle => ("bg-secondary", "Xe m√°y"),
                VehicleType.Bicycle => ("bg-secondary", "Xe ƒë·∫°p"),
                _ => ("bg-secondary", vehicle.VehicleType.ToString())
            };
            
            var gradientClass = (vehicle.VehicleId % 4) switch
            {
                0 => "bg-gradient-primary",
                1 => "bg-gradient-success",
                2 => "bg-gradient-secondary",
                _ => "bg-gradient-info"
            };
            
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 hover-lift">
                    <div class="position-relative">
                        <div class="@gradientClass p-5 text-center">
                            <i class="bi bi-car-front-fill display-1 text-white"></i>
                        </div>
                        <span class="badge @statusBadge.Item1 position-absolute top-0 end-0 m-3">
                            <i class="bi bi-check-circle me-1"></i>@statusBadge.Item2
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title mb-1">@vehicle.Brand @vehicle.Model</h5>
                                <p class="text-muted mb-0">
                                    <i class="bi bi-credit-card-2-front me-1"></i>
                                    <strong>@vehicle.LicensePlate</strong>
                                </p>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-link text-muted" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" asp-page="/Vehicles/Details" asp-route-id="@vehicle.VehicleId">
                                        <i class="bi bi-eye me-2"></i>Xem chi ti·∫øt
                                    </a></li>
                                    @if (Model.IsAdmin() || Model.IsStaff() || item.OwnershipPercentage > 0)
                                    {
                                        <li><a class="dropdown-item" asp-page="/Vehicles/Edit" asp-route-id="@vehicle.VehicleId">
                                            <i class="bi bi-pencil me-2"></i>Ch·ªânh s·ª≠a
                                        </a></li>
                                    }
                                    <li><a class="dropdown-item" asp-page="/Bookings/Create" asp-route-vehicleId="@vehicle.VehicleId">
                                        <i class="bi bi-calendar-check me-2"></i>ƒê·∫∑t l·ªãch
                                    </a></li>
                                    @if (Model.IsAdmin() || Model.IsStaff())
                                    {
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger" href="#">
                                            <i class="bi bi-trash me-2"></i>X√≥a xe
                                        </a></li>
                                    }
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex gap-2 mb-2">
                                <span class="badge @typeBadge.Item1">@typeBadge.Item2</span>
                                @if (vehicle.Year.HasValue)
                                {
                                    <span class="badge bg-secondary">@vehicle.Year</span>
                                }
                            </div>
                        </div>
                        
                        <div class="border-top pt-3">
                            <div class="row text-center g-0">
                                <div class="col-4">
                                    <small class="text-muted d-block">Km hi·ªán t·∫°i</small>
                                    <strong class="text-primary">@(vehicle.CurrentMileage?.ToString("#,##0") ?? "0")</strong>
                                </div>
                                <div class="col-4 border-start border-end">
                                    <small class="text-muted d-block">S·ªü h·ªØu</small>
                                    <strong class="text-success">@($"{item.OwnershipPercentage:N0}%")</strong>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted d-block">Th√†nh vi√™n</small>
                                    <strong>@item.MemberCount</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent">
                        <div class="d-flex gap-2">
                            <a asp-page="/Vehicles/Details" asp-route-id="@vehicle.VehicleId" class="btn btn-sm btn-outline-primary flex-fill">
                                <i class="bi bi-eye me-1"></i>Chi ti·∫øt
                            </a>
                            <a asp-page="/Bookings/Create" asp-route-vehicleId="@vehicle.VehicleId" class="btn btn-sm btn-primary flex-fill">
                                <i class="bi bi-calendar-plus me-1"></i>ƒê·∫∑t l·ªãch
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="card">
        <div class="card-body text-center py-5">
            <i class="bi bi-car-front display-1 text-muted d-block mb-3"></i>
            <h5 class="text-muted">Kh√¥ng t√¨m th·∫•y xe n√†o</h5>
            <p class="text-muted">@(string.IsNullOrEmpty(Model.SearchTerm) && !Model.VehicleTypeFilter.HasValue && !Model.StatusFilter.HasValue 
                ? "B·∫°n ch∆∞a c√≥ xe n√†o trong h·ªá th·ªëng." 
                : "Kh√¥ng c√≥ xe n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc c·ªßa b·∫°n.")</p>
            @if (Model.IsAdmin() || Model.IsStaff())
            {
                <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
                    <i class="bi bi-plus-lg me-2"></i>Th√™m xe m·ªõi
                </button>
            }
        </div>
    </div>
}

<!-- Pagination -->
<nav class="mt-4">
    <ul class="pagination justify-content-center">
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1">Tr∆∞·ªõc</a>
        </li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
            <a class="page-link" href="#">Sau</a>
        </li>
    </ul>
</nav>

<!-- Add Vehicle Modal -->
<div class="modal fade" id="addVehicleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-plus-circle text-primary me-2"></i>Th√™m xe m·ªõi
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addVehicleForm" method="post" asp-page="/Vehicles/Create">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">H√£ng xe</label>
                            <input name="Input.Brand" type="text" class="form-control" placeholder="VD: Tesla, Toyota..." required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Model</label>
                            <input name="Input.Model" type="text" class="form-control" placeholder="VD: Model 3, Camry..." required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Bi·ªÉn s·ªë xe</label>
                            <input name="Input.LicensePlate" type="text" class="form-control" placeholder="VD: 30A-12345" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Lo·∫°i xe</label>
                            <select name="Input.VehicleType" class="form-select" required>
                                <option value="">-- Ch·ªçn lo·∫°i xe --</option>
                                <option value="ElectricCar">Xe ƒëi·ªán</option>
                                <option value="HybridCar">Hybrid</option>
                                <option value="GasolineCar">XƒÉng</option>
                                <option value="Motorcycle">Xe m√°y</option>
                                <option value="Bicycle">Xe ƒë·∫°p</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">NƒÉm s·∫£n xu·∫•t</label>
                            <input name="Input.Year" type="number" class="form-control" placeholder="2023">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">M√†u s·∫Øc</label>
                            <input name="Input.Color" type="text" class="form-control" placeholder="VD: ƒêen, Tr·∫Øng...">
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">M√¥ t·∫£</label>
                            <textarea name="Input.Description" class="form-control" rows="3" placeholder="Th√¥ng tin chi ti·∫øt v·ªÅ xe..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                <button type="submit" form="addVehicleForm" class="btn btn-primary">
                    <i class="bi bi-check-lg me-2"></i>Th√™m xe
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .bg-gradient-primary {
        background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
    }
    .bg-gradient-success {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    }
    .bg-gradient-secondary {
        background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
    }
    .bg-gradient-info {
        background: linear-gradient(135deg, #0EA5E9 0%, #0284C7 100%);
    }
</style>

