@page "{id:int?}"
@model Co_owner_Vehicle.Pages.Vehicles.DetailsModel
@{
    ViewData["Title"] = "Chi tiết xe";
}

<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-page="/Dashboard/CoOwner">Dashboard</a></li>
        <li class="breadcrumb-item"><a asp-page="/Vehicles/Index">Xe</a></li>
        <li class="breadcrumb-item active">@Model.Vehicle?.Brand @Model.Vehicle?.Model</li>
    </ol>
</nav>

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-start mb-4">
    <div>
        <h2 class="fw-bold mb-2">@Model.Vehicle?.Brand @Model.Vehicle?.Model</h2>
        <div class="d-flex gap-2 align-items-center">
            <span class="badge @(Model.Vehicle?.Status == Co_owner_Vehicle.Models.VehicleStatus.Active ? "bg-success" : "bg-secondary") fs-6">
                <i class="bi bi-check-circle me-1"></i>@(Model.Vehicle?.Status.ToString())
            </span>
            <span class="text-muted">•</span>
            <span class="text-muted">Biển số: <strong>@Model.Vehicle?.LicensePlate</strong></span>
        </div>
    </div>
    <div class="btn-group">
        <button class="btn btn-primary">
            <i class="bi bi-calendar-plus me-2"></i>Đặt lịch
        </button>
        <button class="btn btn-outline-primary">
            <i class="bi bi-pencil me-2"></i>Chỉnh sửa
        </button>
        <button class="btn btn-outline-danger">
            <i class="bi bi-trash"></i>
        </button>
    </div>
</div>

<div class="row g-4">
    <!-- Left Column -->
    <div class="col-lg-8">
        <!-- Vehicle Info Card -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-info-circle me-2"></i>Thông tin xe
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <!-- Vehicle Image -->
                    <div class="col-md-4 text-center">
                        <div class="bg-gradient-primary p-5 rounded">
                            <i class="bi bi-car-front-fill display-1 text-white"></i>
                        </div>
                        <button class="btn btn-sm btn-outline-primary mt-3 w-100">
                            <i class="bi bi-camera me-2"></i>Thay đổi ảnh
                        </button>
                    </div>
                    
                    <!-- Vehicle Details -->
                    <div class="col-md-8">
                        <div class="row g-3">
                            <div class="col-6">
                                <label class="text-muted small">Hãng xe</label>
                                <p class="fw-semibold mb-0">@Model.Vehicle?.Brand</p>
                            </div>
                            <div class="col-6">
                                <label class="text-muted small">Model</label>
                                <p class="fw-semibold mb-0">@Model.Vehicle?.Model</p>
                            </div>
                            <div class="col-6">
                                <label class="text-muted small">Năm sản xuất</label>
                                <p class="fw-semibold mb-0">@Model.Vehicle?.Year</p>
                            </div>
                            <div class="col-6">
                                <label class="text-muted small">Màu sắc</label>
                                <p class="fw-semibold mb-0">@Model.Vehicle?.Color</p>
                            </div>
                            <div class="col-6">
                                <label class="text-muted small">Loại xe</label>
                                <p class="mb-0"><span class="badge bg-info">@Model.Vehicle?.VehicleType</span></p>
                            </div>
                            
                            <div class="col-6">
                                <label class="text-muted small">Km hiện tại</label>
                                <p class="fw-semibold mb-0 text-primary">@(Model.Vehicle?.CurrentMileage?.ToString("#,##0") ?? "0") km</p>
                            </div>
                            <div class="col-6">
                                <label class="text-muted small">Giá mua</label>
                                <p class="fw-semibold mb-0">@((Model.Vehicle?.PurchasePrice)?.ToString("#,##0") ?? "-")₫</p>
                            </div>
                            <div class="col-12">
                                <label class="text-muted small">Mô tả</label>
                                <p class="mb-0">@Model.Vehicle?.Description</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ownership Shares -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-pie-chart me-2"></i>Tỷ lệ sở hữu
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Thành viên</th>
                                <th>Email</th>
                                <th>Tỷ lệ</th>
                                <th>Số tiền đầu tư</th>
                                <th>Vai trò</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Owners.Any())
                            {
                                foreach (var o in Model.Owners)
                                {
                                    <tr>
                                        <td><strong>@o.UserName</strong></td>
                                        <td>@o.Email</td>
                                        <td><strong class="text-primary">@o.Percentage.ToString("0.#")%</strong></td>
                                        <td>@o.InvestmentAmount.ToString("#,##0")₫</td>
                                        <td>
                                            <span class="badge bg-secondary">@(o.Role == Co_owner_Vehicle.Models.MemberRole.Member ? "Member" : "Owner")</span>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr><td colspan="5" class="text-muted text-center">Chưa có dữ liệu sở hữu</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Usage -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-clock-history me-2"></i>Lịch sử sử dụng gần đây</span>
                <a href="#" class="text-primary text-decoration-none fs-7">Xem tất cả</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Người dùng</th>
                                <th>Thời gian</th>
                                <th>Quãng đường (ước tính)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.RecentBookings.Any())
                            {
                                foreach (var b in Model.RecentBookings)
                                {
                                    <tr>
                                        <td>@b.UserName</td>
                                        <td>
                                            @b.StartTime.ToLocalTime().ToString("dd/MM/yyyy")<br />
                                            <small class="text-muted">@b.StartTime.ToLocalTime():t - @b.EndTime.ToLocalTime():t</small>
                                        </td>
                                        <td><strong class="text-primary">@b.DistanceKm km</strong></td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr><td colspan="3" class="text-muted text-center">Chưa có lịch sử sử dụng</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Expenses -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-receipt me-2"></i>Chi phí liên quan</span>
                <a href="#" class="text-primary text-decoration-none fs-7">Xem tất cả</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Chi phí</th>
                                <th>Ngày</th>
                                <th>Số tiền</th>
                                <th>Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.RecentExpenses.Any())
                            {
                                foreach (var e in Model.RecentExpenses)
                                {
                                    <tr>
                                        <td>@e.Title</td>
                                        <td>@e.Date.ToLocalTime().ToString("dd/MM/yyyy")</td>
                                        <td><strong>@e.Amount.ToString("#,##0")₫</strong></td>
                                        <td>
                                            <span class="badge @(e.Status == Co_owner_Vehicle.Models.ExpenseStatus.Approved ? "bg-success" : e.Status == Co_owner_Vehicle.Models.ExpenseStatus.Pending ? "bg-warning" : "bg-secondary")">
                                                @e.Status
                                            </span>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr><td colspan="4" class="text-muted text-center">Chưa có chi phí nào</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div class="col-lg-4">
        <!-- Quick Stats -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-graph-up me-2"></i>Thống kê nhanh
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Tổng km đã đi</span>
                        <strong class="text-primary fs-5">@Model.Stats.TotalKm.ToString("#,##0")</strong>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-primary" style="width: 100%"></div>
                    </div>
                    <small class="text-muted">Mục tiêu: 25,000 km</small>
                </div>
                
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Chi phí tháng này</span>
                        <strong class="text-success fs-5">@Model.Stats.MonthExpense.ToString("#,##0")</strong>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: 100%"></div>
                    </div>
                    <small class="text-muted">Trung bình tính theo dữ liệu hiện tại</small>
                </div>
                
                <div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Lịch đặt tháng này</span>
                        <strong class="text-warning fs-5">@Model.Stats.MonthBookings</strong>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-warning" style="width: 100%"></div>
                    </div>
                    <small class="text-muted">Theo dữ liệu lịch đặt</small>
                </div>
            </div>
        </div>

        <!-- Upcoming Bookings -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-calendar-event me-2"></i>Lịch sắp tới
            </div>
            <div class="card-body">
                @if (Model.UpcomingBookings.Any())
                {
                    foreach (var u in Model.UpcomingBookings)
                    {
                        <div class="d-flex gap-3 mb-3 pb-3 border-bottom">
                            <div class="bg-primary text-white rounded text-center p-2" style="min-width: 60px;">
                                <div class="fw-bold fs-4">@u.Start.ToLocalTime().Day</div>
                                <div class="small">Th@u.Start.ToLocalTime().Month</div>
                            </div>
                            <div class="flex-grow-1">
                                <p class="mb-1 fw-semibold">@u.UserName</p>
                                <small class="text-muted">@u.Start.ToLocalTime():t - @u.End.ToLocalTime():t</small><br>
                            </div>
                            <span class="badge @(u.Status == Co_owner_Vehicle.Models.BookingStatus.Confirmed ? "bg-success" : "bg-warning") align-self-start">@u.Status</span>
                        </div>
                    }
                }
                else
                {
                    <div class="text-muted text-center">Chưa có lịch sắp tới</div>
                }
            </div>
        </div>

        <!-- Maintenance Schedule -->
        <div class="card">
            <div class="card-header">
                <i class="bi bi-tools me-2"></i>Lịch bảo trì
            </div>
            <div class="card-body">
                @if (Model.Maintenances.Any())
                {
                    foreach (var m in Model.Maintenances)
                    {
                        <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
                            <div>
                                <p class="mb-1 fw-semibold">@m.Title</p>
                                <small class="text-muted">Lần cuối: @m.LastDate?.ToLocalTime().ToString("dd/MM/yyyy")</small>
                            </div>
                            <span class="badge @(m.Status == Co_owner_Vehicle.Models.ServiceStatus.Completed ? "bg-success" : m.Status == Co_owner_Vehicle.Models.ServiceStatus.InProgress ? "bg-warning" : "bg-secondary")">@m.Status</span>
                        </div>
                    }
                }
                else
                {
                    <div class="text-muted">Chưa có lịch bảo trì</div>
                }
            </div>
        </div>
    </div>
</div>

